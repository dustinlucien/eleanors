<div id="product">

  <div style="background:#fff; overflow:hidden; {% if product.images.size == 1 %}border-bottom:1px solid #ddd; -webkit-box-shadow:0px 1px 0px #fff;{% endif %}">
    <div class="swipe images clearfix" style="width:{{ product.images.size | times:480 }}px;">
      {% for image in product.images %}
      <div class="image">
        <a href="{{ image | product_img_url: 'large'}}" class="preview"><img src="{{ image | product_img_url: 'large'}}" alt="{{ image.alt | escape }}" /></a>
      </div>
      {% endfor %}
    </div> <!-- /.images -->
  </div>
  {% if product.images.size > 1 %}
  <div class="swipe-controls" style="border-bottom:1px solid #ddd; -webkit-box-shadow:0px 1px 0px #fff;">
    <ul>
      {% for image in product.images %}
      <li{% if forloop.first %} class="active"{% endif %}>{{ forloop.index }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <div class="details">
    <div class="description p">
      <h2 class="title">{{ product.title }}</h2>
      {{ product.description}}
    </div>


    <h3 class="title">{{ settings.tr_purchase }} <span class="details price" id="price-preview">{{ product.price_min | money }}{% if product.price_min < product.compare_at_price_min %}<del> {{ product.compare_at_price_min | money }}</del>{% endif %}</span></h3>

    <div class="p">

      <form action="/cart/add" method="post" class="variants clearfix">
        {% if product.options.size > 1 %}
        <div class="select clearfix">
          <select id="product-select" name='id'>
            {% for variant in product.variants %}
            <option value="{{ variant.id }}">{{ variant.title }} - {{ variant.price | money }}</option>
            {% endfor %}
          </select>
        </div> <!-- end multiple options -->
        {% elsif product.options.size == 1 and product.variants.size > 1 %}
        <div class="select clearfix">
          <label>{{ product.options[0] }}</label>
          <select id="product-select" name='id'>
            {% for variant in product.variants %}
            <option value="{{ variant.id }}">{{ variant.title }} - {{ variant.price | money }}</option>
            {% endfor %}
          </select>
        </div>
        {% else %} <!-- end multiple variants -->
        <div class="select" style="display:none;">
          <input type="hidden" name="id" value="{{ product.variants.first.id }}" />
          <input type="radio" name="{{ product.handle }}" value="{{ product.variants.first.title }}" checked="checked" /> {{ product.variants.first.title }}
        </div>
        {% endif %} <!-- end single variant -->
        <div class="purchase clearfix">
          {% if product.variants.size != 1 %}
          {% endif %}
          {% if product.variants.first.available == true && product.variants.size == 1 %}
          <span><input type="submit" name="add" id="add-to-cart" value="{{ settings.tr_add_to_cart }}" class="cart btn" /></span>
          {% else %}
          <span><input type="submit" name="add" id="add-to-cart" value="{{ settings.tr_sold_out }}" disabled="disabled" class="cart btn disabled" /></span>
          {% endif %}
        </div> <!-- /.purchase -->
      </form> <!-- /.variants -->

    </div> <!-- /.details -->

    <h3 class="title">{{ settings.tr_browse_similar }}</h3>
    <ul class="more-info rounded">
      <li><a href="/collections/types?q={{ product.type }}"><span class="detail">{{ settings.tr_type }}</span> {{ product.type }}</a></li>
      <li><a href="/collections/vendors?q={{ product.vendor }}"><span class="detail">{{ settings.tr_vendor }}</span> {{ product.vendor }}</a></li>
    </ul>

    {% if collection %}
    <div class="products">
      <h3 class="title"><a href="{{ collection.url }}">{{ settings.tr_more_from_collection }} <span class="details">{{ settings.tr_view_all }}</span></a></h3>
      {% for product in collection.products limit:4 %}
      {% include 'product-loop' %}
      {% endfor %}
    </div>
    {% endif %}

  </div>

</div> <!-- /#product -->

<script type="text/javascript">
// <![CDATA[  
var selectCallback = function(variant, selector) {
  if (variant && variant.available == true) {
    // selected a valid variant
    jQuery('#add-to-cart').removeClass('disabled').removeAttr('disabled'); // remove unavailable class from add-to-cart button, and re-enable button
    jQuery('#add-to-cart').val("Add to Cart");
    if(variant.price < variant.compare_at_price){
      jQuery('#price-preview').html(Shopify.formatMoney(variant.price, "{{ shop.money_format }}") + "<del>" + Shopify.formatMoney(variant.compare_at_price, "{{ shop.money_format }}") +  "</del>");
    } else {
      jQuery('#price-preview').html(Shopify.formatMoney(variant.price, "{{ shop.money_format }}"));
    }
    jQuery('#add-to-cart').val("{{ settings.tr_add_to_cart }}"); // update button label.
  } else {
    // variant doesn't exist
    jQuery('#add-to-cart').addClass('disabled').attr('disabled', 'disabled');      // set add-to-cart button to unavailable class and disable button
    jQuery('#add-to-cart').val("Sold Out");
    var message = variant ? "{{ settings.tr_sold_out }}" : "{{ settings.tr_unavailable }}";    
    jQuery('#add-to-cart').val(message); // update button label.
  }
};

// initialize multi selector for product
jQuery(function() {
  {% if product.variants.size > 1 or product.options.size > 1 %}
  new Shopify.OptionSelectors("product-select", { product: {{ product | json }}, onVariantSelected: selectCallback });
  
  {% assign found_one_in_stock = false %}
  {% for variant in product.variants %}
    {% if variant.available and found_one_in_stock == false %}
      {% assign found_one_in_stock = true %}
      {% for option in product.options %}
        jQuery('#product-select-option-' + {{ forloop.index0 }}).val({{ variant.options[forloop.index0] | json }}).trigger('change');
      {% endfor %}
    {% endif %}
  {% endfor %}
  
  {% endif %}
});
// ]]>
</script>